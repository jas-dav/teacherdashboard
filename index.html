<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachers Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            display: flex;
            background-color: white;
        }


        .main-content {
            flex: 1;
            padding: 20px 40px;
            margin-left: 60px;
            width: calc(100% - 60px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .content-wrapper {
            width: 100%;
            max-width: 1100px;
        }
        .header {
            margin-bottom: 10px;
            width: 100%;
        }
        .subject {
            color: #666;
            font-size: 16px;
        }
        .title {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
        }
        .underline {
            height: 4px;
            width: 300px;
            background-color: #a7e8b9;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .section-description {
            color: #666;
            margin-bottom: 30px;
            max-width: 800px;
            line-height: 1.5;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            justify-content: center;
        }
        .tab {
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 20px;
            cursor: pointer;
            background-color: #e9ecef;
        }
        .tab.active {
            background-color: #000;
            color: white;
        }
        .selection-container {
            background-color: #e6f2ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }
        .select-group {
            margin-bottom: 10px;
        }
        select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
        }
        .dashboard-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            width: 600px;
        }
        #mentionsTooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px 12px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            pointer-events: none;
            display: none;
            width: 130px;
            text-align: center;
            font-size: 14px;
            line-height: 1.4;
        }
        .mentions-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 400px;
            display: none;
        }
        .mentions-container.visible {
            display: block;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .session-info {
            font-size: 16px;
            color: #666;
        }
        .export-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .export-btn span {
            margin-left: 5px;
        }
        .info-icon {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
        }
        .mentions-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            position: relative;
        }
        .mentions-tooltip {
            display: none;
            position: absolute;
            right: 0;
            top: 30px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
            font-size: 14px;
        }
        .info-icon:hover + .mentions-tooltip {
            display: block;
        }
        .mentions-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .mention-item {
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .mention-time {
            color: #666;
            margin-bottom: 5px;
        }
        .student-name{
            color: #4285f4;
            margin-bottom: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .student-name:hover{
            text-decoration: underline;
        }
        .student-name-transcript {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .mention-text {
            line-height: 1.5;
        }
        .mention-highlight {
            font-style: italic;
        }

        /* Transcript View Styling */
        .transcript-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 400px;
            display: none;
        }
        .transcript-container.visible {
            display: block;
        }
        .transcript-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        .transcript-item {
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        /* New alternating gray background for transcript items */
        .transcript-item:nth-child(odd) {
            background-color: #f6f6f6;
        }
        .back-link {
            color: #4285f4;
            cursor: pointer;
            margin-bottom: 15px;
            display: inline-block;
        }
        #canvas-container {
            position: relative;
            width: 100%;
            height: 350px;
        }
        .mentions-tooltip {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            pointer-events: none;
            display: none;
        }
        .tooltip {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            max-width: 300px;
            z-index: 100;
            right: 20px;
            top: 60px;
        }
        .tooltip.active {
            display: block !important; /* Use !important to override other styles */
        }
        .filter-container {
            display: none;
        }
        .filter-container.active {
            display: block;
        }
    </style>
</head>
<body>


<div class="main-content">
    <div class="content-wrapper">
        <div class="header">
<!--            <div class="subject">Biology</div>-->
            <h1 class="title">Class Dashboard</h1>
            <div class="underline"></div>
        </div>

        <h2 class="section-title">Key Concepts Distribution</h2>
        <p class="section-description">
            Analyze how key concepts are distributed across activities, groups, and individual students.
        </p>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('activity')">Activity</div>
            <div class="tab" onclick="switchTab('group')">Group</div>
            <div class="tab" onclick="switchTab('student')">Student</div>
        </div>

        <div id="activityFilter" class="selection-container filter-container">
            <div class="select-group">
                <label>Select Activity</label>
                <select id="activitySelect" onchange="updateCharts()">
                    <option value="activity1">Activity 1</option>
                    <option value="activity2">Activity 2</option>
                </select>
            </div>
        </div>

        <div id="groupFilter" class="selection-container filter-container">
            <div class="select-group">
                <label>Select Group</label>
                <select id="groupSelect" onchange="updateCharts()">
                    <option value="group1">Group 1</option>
                    <option value="group2">Group 2</option>
                    <option value="group3">Group 3</option>
                </select>
            </div>
            <div class="select-group">
                <label>Select Session</label>
                <select id="groupSessionSelect" onchange="updateCharts()">
                    <option value="11/10/24">11/10/24 at 9:46am</option>
                    <option value="11/12/24">11/12/24 at 4:15pm</option>
                    <option value="11/15/24">11/15/24 at 3:11pm</option>
                </select>
            </div>
        </div>

        <div id="studentFilter" class="selection-container filter-container active">
            <div class="select-group">
                <label>Select Student</label>
                <select id="studentSelect" onchange="updateCharts()">
                    <option value="student1">Student 1</option>
                </select>
            </div>
            <div class="select-group">
                <label>Select Session</label>
                <select id="studentSessionSelect" onchange="updateCharts()">
                    <option value="11/10/24">11/10/24 at 9:46am</option>
                    <option value="11/17/24">11/17/24 at 11:08am</option>
                </select>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="chart-container">
                <div class="chart-header">
                    <div>
                        <h3>Student 1</h3>
                        <div class="session-info">Session 11/15/24</div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <button class="export-btn">
                            + <span>Export</span>
                        </button>
                        <div class="info-icon" onmouseover="showTooltip('chartTooltip')" onmouseout="hideTooltip('chartTooltip')">i</div>
                        <div id="chartTooltip" class="tooltip">
                            <p><strong>Interaction Guide:</strong></p>
                            <p>• Hover over a pie section to see the number of key mentions</p>
                            <p>• Click on a pie section to see all mentions of that concept</p>
                        </div>
                    </div>
                </div>
                <div id="canvas-container">
                    <canvas id="conceptsChart"></canvas>
                    <div id="mentionsTooltip" class="mentions-tooltip"></div>
                </div>
            </div>

            <div id="mentionsContainer" class="mentions-container">
                <div class="mentions-title">
                    <h3 id="mentionsTitle">Mentions of Photosynthesis</h3>
                    <div class="info-icon">i</div>
                    <div class="mentions-tooltip">Click on student name to view transcript</div>
                </div>
                <div id="mentionsList" class="mentions-list">
                    <!-- Mentions will be populated here -->
                </div>
            </div>

            <div id="transcriptContainer" class="transcript-container">
                <a class="back-link" onclick="showMentions()">← Back to mentions</a>
                <h3 class="transcript-title">Transcript View</h3>
                <div id="transcriptList" class="mentions-list">
                    <!-- Transcript will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Main Dashboard Manager Object
        const AnalyticsDashboard = {
            // Mock data store - would be replaced with API calls in production
            mockData: {
                activities: {
                    activity1: {
                        concepts: {
                            "Photosynthesis": 5,
                            "Glucose": 45,
                            "Carbon Dioxide": 18,
                            "Energy": 12,
                            "Chlorophyll": 5
                        }
                    },
                    activity2: {
                        concepts: {
                            "Photosynthesis": 10,
                            "Glucose": 17,
                            "Carbon Dioxide": 22,
                            "Energy": 12,
                            "Chlorophyll": 9
                        }
                    },
                },
                groups: {
                    group1: {
                        sessions: {
                            "11/10/24": {
                                concepts: {
                                    "Photosynthesis": 15,
                                    "Glucose": 12,
                                    "Carbon Dioxide": 10,
                                    "Energy": 7,
                                    "Chlorophyll": 6
                                },
                                mentions: {
                                    "Photosynthesis": [
                                        { "time": "12:03pm", "student": "Student D", "text": "I think photosynthesis uses sunlight to make food", "highlight": "photosynthesis" },
                                        { "time": "12:08pm", "student": "Student E", "text": "Plants need chlorophyll for photosynthesis", "highlight": "photosynthesis" },
                                        { "time": "12:15pm", "student": "Student F", "text": "Does photosynthesis release oxygen?", "highlight": "photosynthesis" },
                                        { "time": "12:18pm", "student": "Student A", "text": "Photosynthesis happens in the leaves, right?", "highlight": "photosynthesis" },
                                        { "time": "12:20pm", "student": "Student C", "text": "Why is photosynthesis important to humans?", "highlight": "photosynthesis" },
                                        { "time": "12:22pm", "student": "Student B", "text": "Photosynthesis is a chemical process", "highlight": "photosynthesis" },
                                        { "time": "12:24pm", "student": "Student E", "text": "Without photosynthesis, there'd be no oxygen", "highlight": "photosynthesis" },
                                        { "time": "12:26pm", "student": "Student F", "text": "I think water is also needed in photosynthesis", "highlight": "photosynthesis" },
                                        { "time": "12:28pm", "student": "Student D", "text": "Photosynthesis needs carbon dioxide too", "highlight": "photosynthesis" },
                                        { "time": "12:30pm", "student": "Student A", "text": "Where does photosynthesis mostly occur?", "highlight": "photosynthesis" },
                                        { "time": "12:32pm", "student": "Student C", "text": "Is photosynthesis affected by temperature?", "highlight": "photosynthesis" },
                                        { "time": "12:34pm", "student": "Student B", "text": "Photosynthesis is slower without sunlight", "highlight": "photosynthesis" },
                                        { "time": "12:36pm", "student": "Student E", "text": "Photosynthesis also produces glucose", "highlight": "photosynthesis" },
                                        { "time": "12:38pm", "student": "Student D", "text": "Can algae do photosynthesis too?", "highlight": "photosynthesis" },
                                        { "time": "12:40pm", "student": "Student F", "text": "Photosynthesis is part of the carbon cycle", "highlight": "photosynthesis" }
                                    ],
                                    "Glucose": [
                                        { "time": "12:05pm", "student": "Student D", "text": "So glucose is the sugar that plants make?", "highlight": "glucose" },
                                        { "time": "12:10pm", "student": "Student F", "text": "I wonder how much glucose a plant produces", "highlight": "glucose" },
                                        { "time": "12:13pm", "student": "Student A", "text": "Glucose is stored in plant roots too", "highlight": "glucose" },
                                        { "time": "12:17pm", "student": "Student C", "text": "What happens to the glucose after it's made?", "highlight": "glucose" },
                                        { "time": "12:19pm", "student": "Student B", "text": "Do animals get glucose by eating plants?", "highlight": "glucose" },
                                        { "time": "12:23pm", "student": "Student E", "text": "Glucose gives plants energy for growth", "highlight": "glucose" },
                                        { "time": "12:25pm", "student": "Student D", "text": "Is glucose part of cellular respiration?", "highlight": "glucose" },
                                        { "time": "12:27pm", "student": "Student F", "text": "I heard glucose can turn into starch", "highlight": "glucose" },
                                        { "time": "12:29pm", "student": "Student A", "text": "Can plants store excess glucose?", "highlight": "glucose" },
                                        { "time": "12:31pm", "student": "Student C", "text": "Glucose is a carbohydrate, right?", "highlight": "glucose" },
                                        { "time": "12:33pm", "student": "Student B", "text": "Is glucose used immediately or stored?", "highlight": "glucose" },
                                        { "time": "12:35pm", "student": "Student E", "text": "Glucose is one of the products of photosynthesis", "highlight": "glucose" }
                                    ],
                                    "Carbon Dioxide": [
                                        { "time": "12:09pm", "student": "Student C", "text": "Plants take in carbon dioxide from the air", "highlight": "carbon dioxide" },
                                        { "time": "12:15pm", "student": "Student A", "text": "So carbon dioxide is used in making glucose?", "highlight": "carbon dioxide" },
                                        { "time": "12:19pm", "student": "Student B", "text": "Is there enough carbon dioxide in the air for plants?", "highlight": "carbon dioxide" },
                                        { "time": "12:27pm", "student": "Student C", "text": "What would happen if there was too much carbon dioxide?", "highlight": "carbon dioxide" },
                                        { "time": "12:30pm", "student": "Student F", "text": "Carbon dioxide comes from us breathing, right?", "highlight": "carbon dioxide" },
                                        { "time": "12:32pm", "student": "Student D", "text": "Carbon dioxide levels affect climate too", "highlight": "carbon dioxide" },
                                        { "time": "12:34pm", "student": "Student A", "text": "Plants help reduce carbon dioxide", "highlight": "carbon dioxide" },
                                        { "time": "12:36pm", "student": "Student E", "text": "Does burning fuel increase carbon dioxide?", "highlight": "carbon dioxide" },
                                        { "time": "12:38pm", "student": "Student B", "text": "Carbon dioxide is a greenhouse gas", "highlight": "carbon dioxide" },
                                        { "time": "12:40pm", "student": "Student C", "text": "What limits the carbon dioxide plants can absorb?", "highlight": "carbon dioxide" }
                                    ],
                                    "Energy": [
                                        { "time": "12:06pm", "student": "Student A", "text": "Photosynthesis turns light into energy", "highlight": "energy" },
                                        { "time": "12:26pm", "student": "Student F", "text": "Plants use that energy to grow", "highlight": "energy" },
                                        { "time": "12:28pm", "student": "Student D", "text": "Is light the only energy source for plants?", "highlight": "energy" },
                                        { "time": "12:35pm", "student": "Student A", "text": "How efficient is energy conversion in photosynthesis?", "highlight": "energy" }
                                    ],
                                    "Chlorophyll": [
                                        { "time": "12:05pm", "student": "Student D", "text": "Is chlorophyll in all plants?", "highlight": "chlorophyll" },
                                        { "time": "12:10pm", "student": "Student F", "text": "Can we extract chlorophyll from leaves?", "highlight": "chlorophyll" },
                                        { "time": "12:14pm", "student": "Student E", "text": "Chlorophyll gives leaves their green color", "highlight": "chlorophyll" },
                                        { "time": "12:21pm", "student": "Student A", "text": "Does chlorophyll absorb all colors of light?", "highlight": "chlorophyll" },
                                        { "time": "12:29pm", "student": "Student C", "text": "What happens if a plant has no chlorophyll?", "highlight": "chlorophyll" },
                                        { "time": "12:37pm", "student": "Student B", "text": "Chlorophyll is essential for capturing sunlight", "highlight": "chlorophyll" }
                                    ]
                                },
                                transcript: [
                                    {time: "12:03pm", speaker: "Student D", text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit"},
                                    {time: "12:04pm", speaker: "AI Chatbot", text: "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."},
                                    {time: "12:05pm", speaker: "Student D", text: "Ut enim ad minim veniam, quis nostrud exercitation?"},
                                    {time: "12:06pm", speaker: "AI Chatbot", text: "Ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit."},
                                    {time: "12:08pm", speaker: "Student E", text: "Voluptate velit esse cillum dolore eu fugiat nulla pariatur"},
                                    {time: "12:09pm", speaker: "AI Chatbot", text: "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia."},
                                    {time: "12:10pm", speaker: "Student F", text: "Deserunt mollit anim id est laborum sed ut perspiciatis"},
                                    {time: "12:11pm", speaker: "AI Chatbot", text: "Unde omnis iste natus error sit voluptatem accusantium doloremque laudantium."},
                                    {time: "12:15pm", speaker: "Student F", text: "Totam rem aperiam, eaque ipsa quae ab illo inventore?"},
                                    {time: "12:16pm", speaker: "AI Chatbot", text: "Veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem."}
                                ]
                            }
                        }
                    },
                    othergroup: {
                        sessions: {
                            "11/15/24": {
                                concepts: {
                                    "Photosynthesis": 15,
                                    "Glucose": 12,
                                    "Carbon Dioxide": 10,
                                    "Energy": 7,
                                    "Chlorophyll": 6
                                },
                                mentions: {
                                    "Photosynthesis": [
                                        { "time": "12:03pm", "student": "Student D", "text": "I think photosynthesis uses sunlight to make food", "highlight": "photosynthesis" },
                                        { "time": "12:08pm", "student": "Student E", "text": "Plants need chlorophyll for photosynthesis", "highlight": "photosynthesis" },
                                        { "time": "12:15pm", "student": "Student F", "text": "Does photosynthesis release oxygen?", "highlight": "photosynthesis" },
                                        { "time": "12:18pm", "student": "Student A", "text": "Photosynthesis happens in the leaves, right?", "highlight": "photosynthesis" },
                                        { "time": "12:20pm", "student": "Student C", "text": "Why is photosynthesis important to humans?", "highlight": "photosynthesis" },
                                        { "time": "12:22pm", "student": "Student B", "text": "Photosynthesis is a chemical process", "highlight": "photosynthesis" },
                                        { "time": "12:24pm", "student": "Student E", "text": "Without photosynthesis, there'd be no oxygen", "highlight": "photosynthesis" },
                                        { "time": "12:26pm", "student": "Student F", "text": "I think water is also needed in photosynthesis", "highlight": "photosynthesis" },
                                        { "time": "12:28pm", "student": "Student D", "text": "Photosynthesis needs carbon dioxide too", "highlight": "photosynthesis" },
                                        { "time": "12:30pm", "student": "Student A", "text": "Where does photosynthesis mostly occur?", "highlight": "photosynthesis" },
                                        { "time": "12:32pm", "student": "Student C", "text": "Is photosynthesis affected by temperature?", "highlight": "photosynthesis" },
                                        { "time": "12:34pm", "student": "Student B", "text": "Photosynthesis is slower without sunlight", "highlight": "photosynthesis" },
                                        { "time": "12:36pm", "student": "Student E", "text": "Photosynthesis also produces glucose", "highlight": "photosynthesis" },
                                        { "time": "12:38pm", "student": "Student D", "text": "Can algae do photosynthesis too?", "highlight": "photosynthesis" },
                                        { "time": "12:40pm", "student": "Student F", "text": "Photosynthesis is part of the carbon cycle", "highlight": "photosynthesis" }
                                    ],
                                    "Glucose": [
                                        { "time": "12:05pm", "student": "Student D", "text": "So glucose is the sugar that plants make?", "highlight": "glucose" },
                                        { "time": "12:10pm", "student": "Student F", "text": "I wonder how much glucose a plant produces", "highlight": "glucose" },
                                        { "time": "12:13pm", "student": "Student A", "text": "Glucose is stored in plant roots too", "highlight": "glucose" },
                                        { "time": "12:17pm", "student": "Student C", "text": "What happens to the glucose after it's made?", "highlight": "glucose" },
                                        { "time": "12:19pm", "student": "Student B", "text": "Do animals get glucose by eating plants?", "highlight": "glucose" },
                                        { "time": "12:23pm", "student": "Student E", "text": "Glucose gives plants energy for growth", "highlight": "glucose" },
                                        { "time": "12:25pm", "student": "Student D", "text": "Is glucose part of cellular respiration?", "highlight": "glucose" },
                                        { "time": "12:27pm", "student": "Student F", "text": "I heard glucose can turn into starch", "highlight": "glucose" },
                                        { "time": "12:29pm", "student": "Student A", "text": "Can plants store excess glucose?", "highlight": "glucose" },
                                        { "time": "12:31pm", "student": "Student C", "text": "Glucose is a carbohydrate, right?", "highlight": "glucose" },
                                        { "time": "12:33pm", "student": "Student B", "text": "Is glucose used immediately or stored?", "highlight": "glucose" },
                                        { "time": "12:35pm", "student": "Student E", "text": "Glucose is one of the products of photosynthesis", "highlight": "glucose" }
                                    ],
                                    "Carbon Dioxide": [
                                        { "time": "12:09pm", "student": "Student C", "text": "Plants take in carbon dioxide from the air", "highlight": "carbon dioxide" },
                                        { "time": "12:15pm", "student": "Student A", "text": "So carbon dioxide is used in making glucose?", "highlight": "carbon dioxide" },
                                        { "time": "12:19pm", "student": "Student B", "text": "Is there enough carbon dioxide in the air for plants?", "highlight": "carbon dioxide" },
                                        { "time": "12:27pm", "student": "Student C", "text": "What would happen if there was too much carbon dioxide?", "highlight": "carbon dioxide" },
                                        { "time": "12:30pm", "student": "Student F", "text": "Carbon dioxide comes from us breathing, right?", "highlight": "carbon dioxide" },
                                        { "time": "12:32pm", "student": "Student D", "text": "Carbon dioxide levels affect climate too", "highlight": "carbon dioxide" },
                                        { "time": "12:34pm", "student": "Student A", "text": "Plants help reduce carbon dioxide", "highlight": "carbon dioxide" },
                                        { "time": "12:36pm", "student": "Student E", "text": "Does burning fuel increase carbon dioxide?", "highlight": "carbon dioxide" },
                                        { "time": "12:38pm", "student": "Student B", "text": "Carbon dioxide is a greenhouse gas", "highlight": "carbon dioxide" },
                                        { "time": "12:40pm", "student": "Student C", "text": "What limits the carbon dioxide plants can absorb?", "highlight": "carbon dioxide" }
                                    ],
                                    "Energy": [
                                        { "time": "12:06pm", "student": "Student A", "text": "Photosynthesis turns light into energy", "highlight": "energy" },
                                        { "time": "12:26pm", "student": "Student F", "text": "Plants use that energy to grow", "highlight": "energy" },
                                        { "time": "12:28pm", "student": "Student D", "text": "Is light the only energy source for plants?", "highlight": "energy" },
                                        { "time": "12:35pm", "student": "Student A", "text": "How efficient is energy conversion in photosynthesis?", "highlight": "energy" }
                                    ],
                                    "Chlorophyll": [
                                        { "time": "12:05pm", "student": "Student D", "text": "Is chlorophyll in all plants?", "highlight": "chlorophyll" },
                                        { "time": "12:10pm", "student": "Student F", "text": "Can we extract chlorophyll from leaves?", "highlight": "chlorophyll" },
                                        { "time": "12:14pm", "student": "Student E", "text": "Chlorophyll gives leaves their green color", "highlight": "chlorophyll" },
                                        { "time": "12:21pm", "student": "Student A", "text": "Does chlorophyll absorb all colors of light?", "highlight": "chlorophyll" },
                                        { "time": "12:29pm", "student": "Student C", "text": "What happens if a plant has no chlorophyll?", "highlight": "chlorophyll" },
                                        { "time": "12:37pm", "student": "Student B", "text": "Chlorophyll is essential for capturing sunlight", "highlight": "chlorophyll" }
                                    ]
                                },
                                transcript: [
                                    {time: "12:03pm", speaker: "Student D", text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit"},
                                    {time: "12:04pm", speaker: "AI Chatbot", text: "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."},
                                    {time: "12:05pm", speaker: "Student D", text: "Ut enim ad minim veniam, quis nostrud exercitation?"},
                                    {time: "12:06pm", speaker: "AI Chatbot", text: "Ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit."},
                                    {time: "12:08pm", speaker: "Student E", text: "Voluptate velit esse cillum dolore eu fugiat nulla pariatur"},
                                    {time: "12:09pm", speaker: "AI Chatbot", text: "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia."},
                                    {time: "12:10pm", speaker: "Student F", text: "Deserunt mollit anim id est laborum sed ut perspiciatis"},
                                    {time: "12:11pm", speaker: "AI Chatbot", text: "Unde omnis iste natus error sit voluptatem accusantium doloremque laudantium."},
                                    {time: "12:15pm", speaker: "Student F", text: "Totam rem aperiam, eaque ipsa quae ab illo inventore?"},
                                    {time: "12:16pm", speaker: "AI Chatbot", text: "Veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem."}
                                ]
                            }
                        }
                    }
                },
                students: {
                    student1: {
                        sessions: {
                            "11/15/24": {
                                concepts: {
                                    "Photosynthesis": 5,
                                    "Glucose": 3,
                                    "Carbon Dioxide": 2,
                                    "Energy": 2,
                                    "Chlorophyll": 1
                                },
                                mentions: {
                                    "Photosynthesis": [
                                        {time: "12:05pm", student: "Student 1", text: "I think plants need sunlight for photosynthesis to work", highlight: "photosynthesis"},
                                        {time: "12:12pm", student: "Student 1", text: "Does photosynthesis happen at night?", highlight: "photosynthesis"},
                                        {time: "12:18pm", student: "Student 1", text: "So photosynthesis creates oxygen as a byproduct?", highlight: "photosynthesis"},
                                        {time: "12:25pm", student: "Student 1", text: "In photosynthesis, water is split into hydrogen and oxygen, right?", highlight: "photosynthesis"},
                                        {time: "12:33pm", student: "Student 1", text: "How efficient is photosynthesis compared to solar panels?", highlight: "photosynthesis"}
                                    ],
                                    "Glucose": [
                                        {time: "12:08pm", student: "Student 1", text: "Is glucose the main product of photosynthesis?", highlight: "glucose"},
                                        {time: "12:22pm", student: "Student 1", text: "Can plants convert glucose to other sugars?", highlight: "glucose"},
                                        {time: "12:37pm", student: "Student 1", text: "Where is glucose stored in plant cells?", highlight: "glucose"}
                                    ],
                                    "Carbon Dioxide": [
                                        {time: "12:15pm", student: "Student 1", text: "How much carbon dioxide does a typical plant absorb?", highlight: "carbon dioxide"},
                                        {time: "12:28pm", student: "Student 1", text: "Do plants need a minimum level of carbon dioxide to survive?", highlight: "carbon dioxide"}
                                    ],
                                    "Energy": [
                                        {time: "12:10pm", student: "Student 1", text: "How is light energy converted to chemical energy?", highlight: "energy"},
                                        {time: "12:30pm", student: "Student 1", text: "Do plants use energy at night?", highlight: "energy"}
                                    ],
                                    "Chlorophyll": [
                                        {time: "12:20pm", student: "Student 1", text: "Are there different types of chlorophyll?", highlight: "chlorophyll"}
                                    ]
                                },
                                transcript: [
                                    {time: "12:05pm", speaker: "Student 1", text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit"},
                                    {time: "12:06pm", speaker: "AI Chatbot", text: "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."},
                                    {time: "12:08pm", speaker: "Student 3", text: "Ut enim ad minim veniam, quis nostrud exercitation?"},
                                    {time: "12:09pm", speaker: "AI Chatbot", text: "Ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit."},
                                    {time: "12:10pm", speaker: "Student 1", text: "Voluptate velit esse cillum dolore eu fugiat nulla pariatur"},
                                ]
                            }
                        }
                    },
                }
            },

            // State management
            state: {
                currentTab: 'student',
                currentGroup: 'Group 3',
                currentStudent: 'student1',
                currentActivity: 'activity1',
                currentSession: '11/15/24',
                currentConcept: null,
                myChart: null,
                chartTooltipVisible: false
            },

            // Color schemes for the pie chart
            chartColors: [
                'rgb(106, 198, 212)', // Photosynthesis (teal)
                'rgb(231, 123, 141)', // Glucose (pink/red)
                'rgb(246, 188, 122)', // Carbon Dioxide (orange)
                'rgb(244, 224, 134)', // Energy (yellow)
                'rgb(108, 148, 231)'  // Chlorophyll (blue)
            ],

            // =============================================================
            // Initialization Methods
            // =============================================================

            // Main initialization method - entry point for the dashboard
            init() {
                this.switchTab('activity');
                this.updateCharts();
                this.setupEventListeners();

                // Make methods available globally to work with inline event handlers
                this.exposeGlobalMethods();
            },

            // Setup all event listeners for the dashboard
            setupEventListeners() {
                // Close mentions/transcript containers when clicking outside
                document.addEventListener('click', (event) => {
                    if (!event.target.closest('.chart-container') &&
                        !event.target.closest('.mentions-container') &&
                        !event.target.closest('.transcript-container')) {
                        document.getElementById('mentionsContainer').classList.remove('visible');
                        document.getElementById('transcriptContainer').classList.remove('visible');
                    }
                });
            },

            // Expose methods globally for inline HTML event handlers
            exposeGlobalMethods() {
                // These functions need to be globally available for the HTML onclick handlers
                window.switchTab = (tab) => this.switchTab(tab);
                window.updateCharts = () => this.updateCharts();
                window.showMentions = () => this.showMentions();
                window.showTooltip = (tooltipId) => this.showTooltip(tooltipId);
                window.hideTooltip = (tooltipId) => this.hideTooltip(tooltipId);
            },

            // =============================================================
            // Tab Management Methods
            // =============================================================

            // Switch between activity, group, and student tabs
            switchTab(tab) {
                this.state.currentTab = tab;

                // Update UI for active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`.tab:nth-child(${tab === 'activity' ? 1 : tab === 'group' ? 2 : 3})`).classList.add('active');

                // Show the appropriate filter container
                document.querySelectorAll('.filter-container').forEach(fc => fc.classList.remove('active'));
                document.getElementById(`${tab}Filter`).classList.add('active');

                // Update tooltip content based on tab
                this.updateTooltipContent(tab);

                // Update chart data
                this.updateCharts();

                // Hide mentions container when switching tabs
                document.getElementById('mentionsContainer').classList.remove('visible');
                document.getElementById('transcriptContainer').classList.remove('visible');
            },

            // Update tooltip content based on current tab
            updateTooltipContent(tab) {
                const tooltipElem = document.getElementById('chartTooltip');

                if (tab === 'activity') {
                    tooltipElem.innerHTML = `
                    <p><strong>Interaction Guide:</strong></p>
                    <p>• Hover on a pie section to see the number of key topic mentions.</p>
                `;
                } else {
                    tooltipElem.innerHTML = `
                    <p><strong>Interaction Guide:</strong></p>
                    <p>• Hover over a pie section to see the number of mentions</p>
                    <p>• Click on a pie section to see all mentions of that concept</p>
                `;
                }
            },

            // =============================================================
            // Data & Chart Methods
            // =============================================================

            // Update charts based on current selection
            updateCharts() {
                let chartData;

                // Update UI and get data based on current tab
                if (this.state.currentTab === 'group') {
                    this.state.currentGroup = document.getElementById('groupSelect').value;
                    this.state.currentSession = document.getElementById('groupSessionSelect').value;

                    // Update chart header
                    document.querySelector('.chart-header h3').textContent = `Group ${this.state.currentGroup.replace('group', '')}`;
                    document.querySelector('.session-info').textContent = `Session ${this.state.currentSession}`;

                    // Get data for current group/session
                    chartData = this.getGroupData();
                }
                else if (this.state.currentTab === 'student') {
                    this.state.currentStudent = document.getElementById('studentSelect').value;
                    this.state.currentSession = document.getElementById('studentSessionSelect').value;

                    // Get student name from select option text
                    const studentSelect = document.getElementById('studentSelect');
                    const studentName = studentSelect.options[studentSelect.selectedIndex].text;

                    // Update chart header
                    document.querySelector('.chart-header h3').textContent = studentName;
                    document.querySelector('.session-info').textContent = `Session ${this.state.currentSession}`;

                    // Get data for current student/session
                    chartData = this.getStudentData();
                }
                else if (this.state.currentTab === 'activity') {
                    this.state.currentActivity = document.getElementById('activitySelect').value;

                    // Get activity name from select option text
                    const activitySelect = document.getElementById('activitySelect');
                    const activityName = activitySelect.options[activitySelect.selectedIndex].text;

                    // Update chart header
                    document.querySelector('.chart-header h3').textContent = activityName;
                    document.querySelector('.session-info').textContent = 'All Sessions';

                    // Get data for current activity
                    chartData = this.getActivityData();
                }

                // Render the pie chart with the data
                this.renderPieChart(chartData.concepts);

                // Hide mentions container
                document.getElementById('mentionsContainer').classList.remove('visible');
                document.getElementById('transcriptContainer').classList.remove('visible');
            },

            // Get data for the current activity
            getActivityData() {
                if (this.mockData.activities[this.state.currentActivity]) {
                    return this.mockData.activities[this.state.currentActivity];
                } else {
                    // Use default activity data if current selection not found
                    return this.mockData.activities.activity1;
                }
            },

            // Get data for the current group session
            getGroupData() {
                if (this.mockData.groups[this.state.currentGroup] &&
                    this.mockData.groups[this.state.currentGroup].sessions[this.state.currentSession]) {
                    return this.mockData.groups[this.state.currentGroup].sessions[this.state.currentSession];
                } else {
                    // Use default group data if current selection not found
                    return this.mockData.groups.othergroup.sessions["11/15/24"];
                }
            },

            // Get data for the current student session
            getStudentData() {
                if (this.mockData.students[this.state.currentStudent] &&
                    this.mockData.students[this.state.currentStudent].sessions[this.state.currentSession]) {
                    return this.mockData.students[this.state.currentStudent].sessions[this.state.currentSession];
                } else {
                    // Use default student data if current selection not found
                    return this.mockData.students.student1.sessions["11/15/24"];
                }
            },

            // Render the pie chart with the provided data
            renderPieChart(conceptsData) {
                // Clear any existing chart
                if (this.state.myChart) {
                    this.state.myChart.destroy();
                }

                const ctx = document.getElementById('conceptsChart').getContext('2d');

                // Prepare data for chart.js
                const labels = Object.keys(conceptsData);
                const rawCounts = Object.values(conceptsData);

                // Calculate total and convert to percentages
                const total = rawCounts.reduce((sum, count) => sum + count, 0);
                const percentages = rawCounts.map(count => (count / total) * 100);

                // Store original concept names for later reference
                const originalConcepts = [...labels];

                // Create the pie chart
                this.state.myChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels.map((label, i) => `${label}: ${percentages[i].toFixed(1)}%`),
                        datasets: [{
                            data: percentages,
                            backgroundColor: this.chartColors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'left',
                                labels: {
                                    boxWidth: 12,
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                enabled: false
                            }
                        },
                        onClick: (event, elements) => {
                            // Only respond to clicks in group and student tabs
                            if (this.state.currentTab !== 'activity' && elements.length > 0) {
                                const index = elements[0].index;
                                // Use the original concept name, not the formatted label
                                const concept = originalConcepts[index];
                                this.showConceptMentions(concept);
                            }
                        },
                        onHover: (event, elements) => {
                            const tooltip = document.getElementById('mentionsTooltip');

                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const concept = originalConcepts[index]; // Use original concept name
                                const mentions = rawCounts[index]; // Use raw counts for tooltip

                                // Position the tooltip near the hovered element
                                const canvasPosition = event.native.target.getBoundingClientRect();
                                const offsetX = event.native.offsetX;
                                const offsetY = event.native.offsetY;

                                tooltip.innerHTML = `${concept}<br>${mentions} mentions`;
                                tooltip.style.display = 'block';
                                tooltip.style.left = (offsetX + 10) + 'px';
                                tooltip.style.top = (offsetY + 10) + 'px';
                            } else {
                                tooltip.style.display = 'none';
                            }
                        }
                    }
                });

                // Remove any old HTML elements for labels that may have been added
                const oldLabels = document.querySelectorAll('.pie-label');
                oldLabels.forEach(label => label.remove());
            },

            // =============================================================
            // Mentions & Transcript Methods
            // =============================================================

            // Show mentions for a specific concept
            showConceptMentions(concept) {
                // Extract the base concept name by removing percentages and trimming whitespace
                // This addresses labels that are formatted like "Concept: X.X%" in the chart
                const baseConcept = concept.split(':')[0].trim();
                this.state.currentConcept = baseConcept;

                console.log(`Looking for mentions of concept: ${baseConcept}`);

                // Get the mentions based on current tab
                let mentions;
                let sourceData;

                if (this.state.currentTab === 'group') {
                    sourceData = this.getGroupData();
                } else if (this.state.currentTab === 'student') {
                    sourceData = this.getStudentData();
                } else {
                    // For activity tab, use default group data for demonstration
                    sourceData = this.mockData.groups.othergroup.sessions["11/15/24"];
                }

                // Debug what data we're working with
                console.log("Source data for mentions:", sourceData);

                // Check if mentions exist for this concept
                if (sourceData.mentions && sourceData.mentions[baseConcept]) {
                    mentions = sourceData.mentions[baseConcept];
                } else {
                    // Try a case-insensitive search through available concept keys
                    const availableConcepts = sourceData.mentions ? Object.keys(sourceData.mentions) : [];
                    console.log("Available concepts:", availableConcepts);

                    const matchingConcept = availableConcepts.find(
                        key => key.toLowerCase() === baseConcept.toLowerCase()
                    );

                    if (matchingConcept) {
                        mentions = sourceData.mentions[matchingConcept];
                        // Update current concept to use the exact case found in the data
                        this.state.currentConcept = matchingConcept;
                    } else {
                        mentions = [];
                    }
                }

                // Update mentions title
                document.getElementById('mentionsTitle').textContent = `Mentions of ${this.state.currentConcept}`;

                // Populate mentions list
                const mentionsList = document.getElementById('mentionsList');
                mentionsList.innerHTML = '';

                if (!mentions || mentions.length === 0) {
                    mentionsList.innerHTML = '<p>No mentions found for this concept.</p>';
                    console.log(`No mentions found for concept: ${this.state.currentConcept}`);
                } else {
                    console.log(`Found ${mentions.length} mentions for concept: ${this.state.currentConcept}`);

                    mentions.forEach(mention => {
                        const mentionItem = document.createElement('div');
                        mentionItem.className = 'mention-item';

                        const timeElem = document.createElement('div');
                        timeElem.className = 'mention-time';
                        timeElem.textContent = mention.time;
                        mentionItem.appendChild(timeElem);

                        const studentElem = document.createElement('div');
                        studentElem.className = 'student-name';
                        studentElem.textContent = mention.student;
                        studentElem.onclick = () => this.showTranscript(mention.student);
                        mentionItem.appendChild(studentElem);

                        const textElem = document.createElement('div');
                        textElem.className = 'mention-text';
                        textElem.innerHTML = this.formatMentionText(mention.text, mention.highlight);
                        mentionItem.appendChild(textElem);

                        mentionsList.appendChild(mentionItem);
                    });
                }

                // Show the mentions container
                document.getElementById('mentionsContainer').classList.add('visible');
                document.getElementById('transcriptContainer').classList.remove('visible');
            },

            // Show transcript for a student
            showTranscript(student) {
                // Get the transcript based on current tab
                let transcript;
                if (this.state.currentTab === 'group') {
                    const groupData = this.getGroupData();
                    transcript = groupData.transcript || [];
                } else if (this.state.currentTab === 'student') {
                    const studentData = this.getStudentData();
                    transcript = studentData.transcript || [];
                } else {
                    // For activity tab, use default data for now
                    const groupData = this.mockData.groups.othergroup.sessions["11/15/24"];
                    transcript = groupData.transcript || [];
                }

                // Populate transcript list
                const transcriptList = document.getElementById('transcriptList');
                transcriptList.innerHTML = '';

                if (transcript.length === 0) {
                    transcriptList.innerHTML = '<p>No transcript available for this session.</p>';
                } else {
                    transcript.forEach(item => {
                        const transcriptItem = document.createElement('div');
                        transcriptItem.className = 'transcript-item';

                        const timeElem = document.createElement('div');
                        timeElem.className = 'mention-time';
                        timeElem.textContent = item.time;
                        transcriptItem.appendChild(timeElem);

                        const speakerElem = document.createElement('div');
                        speakerElem.className = 'student-name-transcript';
                        speakerElem.textContent = item.speaker;
                        transcriptItem.appendChild(speakerElem);

                        const textElem = document.createElement('div');
                        textElem.className = 'mention-text';
                        textElem.innerHTML = this.formatMentionText(item.text, this.state.currentConcept);
                        transcriptItem.appendChild(textElem);

                        transcriptList.appendChild(transcriptItem);
                    });
                }

                // Show the transcript container
                document.getElementById('transcriptContainer').classList.add('visible');
                document.getElementById('mentionsContainer').classList.remove('visible');
            },

            // Go back to mentions view from transcript view
            showMentions() {
                document.getElementById('mentionsContainer').classList.add('visible');
                document.getElementById('transcriptContainer').classList.remove('visible');
            },

            // =============================================================
            // Utility Methods
            // =============================================================

            // Format mention text to highlight concept keywords
            formatMentionText(text, highlight) {
                if (!highlight || !text.toLowerCase().includes(highlight.toLowerCase())) {
                    return text;
                }

                const regex = new RegExp(`(${highlight})`, 'gi');
                return text.replace(regex, '<span class="mention-highlight">$1</span>');
            },

            // Show tooltip helper method
            showTooltip(tooltipId) {
                document.getElementById(tooltipId).classList.add('active');
            },

            // Hide tooltip helper method
            hideTooltip(tooltipId) {
                document.getElementById(tooltipId).classList.remove('active');
            }
        };

        // Initialize the dashboard
        AnalyticsDashboard.init();

        // Set initialization function for window.onload to maintain compatibility
        window.onload = function() {
            // Set default tab to activity to match your requirement
            AnalyticsDashboard.state.currentTab = 'activity';
            AnalyticsDashboard.init();
        };
    });
</script>
</body>
</html>

